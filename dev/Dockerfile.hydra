FROM node:18-slim

# Install development tools
RUN apt-get update && apt-get install -y --no-install-recommends \
    dumb-init \
    openssl \
    curl \
  && apt-get clean \
  && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Copy package files
COPY package*.json ./

# Install dependencies including dev dependencies
RUN npm ci

# Copy application code
COPY . .

# Create directories for JWT keys
RUN mkdir -p /app/jwt-keys

# Expose port
EXPOSE 6969

# Use nodemon for hot reloading in development
ENTRYPOINT ["dumb-init", "--"]
CMD ["npx", "nodemon", "--watch", ".", "--watch", "routes", "--watch", "views", "--ext", "js,ejs", "index.js"]
