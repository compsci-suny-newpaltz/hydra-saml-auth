\documentclass[11pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{geometry}
\usepackage{hyperref}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{booktabs}
\usepackage{array}
\usepackage{fancyhdr}
\usepackage{enumitem}
\usepackage{float}
\usepackage{mdframed}
\usepackage{longtable}

\geometry{margin=1in}

\definecolor{hydra-blue}{RGB}{5,32,73}
\definecolor{code-bg}{RGB}{248,248,248}
\definecolor{warning-bg}{RGB}{255,243,205}
\definecolor{success-bg}{RGB}{212,237,218}
\definecolor{info-bg}{RGB}{217,237,247}
\definecolor{danger-bg}{RGB}{248,215,218}
\definecolor{done-bg}{RGB}{200,230,201}

\hypersetup{colorlinks=true,linkcolor=hydra-blue,urlcolor=blue}

\lstdefinestyle{bash}{backgroundcolor=\color{code-bg},basicstyle=\ttfamily\small,breaklines=true,frame=single,numbers=none}
\lstdefinestyle{yaml}{backgroundcolor=\color{code-bg},basicstyle=\ttfamily\small,breaklines=true,frame=single,numbers=left}

\newmdenv[backgroundcolor=warning-bg,linewidth=0pt,innerleftmargin=10pt,innerrightmargin=10pt,innertopmargin=10pt,innerbottommargin=10pt]{warningbox}
\newmdenv[backgroundcolor=success-bg,linewidth=0pt,innerleftmargin=10pt,innerrightmargin=10pt,innertopmargin=10pt,innerbottommargin=10pt]{successbox}
\newmdenv[backgroundcolor=info-bg,linewidth=0pt,innerleftmargin=10pt,innerrightmargin=10pt,innertopmargin=10pt,innerbottommargin=10pt]{infobox}
\newmdenv[backgroundcolor=danger-bg,linewidth=0pt,innerleftmargin=10pt,innerrightmargin=10pt,innertopmargin=10pt,innerbottommargin=10pt]{dangerbox}
\newmdenv[backgroundcolor=done-bg,linewidth=2pt,linecolor=green!50!black,innerleftmargin=10pt,innerrightmargin=10pt,innertopmargin=10pt,innerbottommargin=10pt]{donebox}

\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{\textbf{Hydra Cluster Audit}}
\fancyhead[R]{\textbf{February 4, 2026}}
\fancyfoot[C]{\thepage}
\setlength{\headheight}{14pt}

\title{\textbf{Hydra Cluster Audit Report}\\[0.5em]\large Comprehensive Discovery, Cleanup \& Hardening}
\author{Infrastructure Team\\SUNY New Paltz Computer Science}
\date{February 4, 2026}

\begin{document}
\maketitle
\tableofcontents
\newpage

%% ============================================================
\section{Executive Summary}
%% ============================================================

This document records the full audit, cleanup, and hardening of the 3-node Hydra RKE2 Kubernetes cluster performed on February 4, 2026. Key actions taken:

\begin{donebox}
\textbf{Completed Actions:}
\begin{itemize}[nosep]
    \item Disabled host-level MariaDB systemd service (duplicate of Docker container)
    \item Disabled and masked Samba (smbd/nmbd) --- no configured shares, ports 139/445 closed
    \item Deleted 4 orphaned ZFS storage classes (hydra-hot, hydra-warm, hydra-cold, hydra-gpu)
    \item Backed up all Docker Compose files, Apache configs, .env files, Traefik dynamic configs
    \item CS Lab backend + MariaDB fully deployed to K8s (15 tables, all data migrated)
    \item Created and applied 8 K8s IngressRoutes replacing all Apache proxy rules
    \item Audited Chimera and Cerberus (both clean --- no Samba, RKE2 agents healthy)
    \item Archived and removed \texttt{/var/www} static content ($\sim$436\,MB)
    \item Archived Apache configuration files
    \item Stopped and removed 4 redundant Docker containers (cs-lab-backend, cs-lab-db, hydra-saml-auth, traefik)
    \item Cleaned dangling Docker images and unused volumes
    \item Removed stale ExternalName service \texttt{cs-lab-website}
    \item Fixed GPU operator: removed NVIDIA labels from Hydra (no GPU), GPU pods now only run on Chimera/Cerberus
    \item Fixed n8n and git-learning 502 errors (changed localhost bindings to 0.0.0.0)
    \item Fixed admin API unreachable (changed \texttt{app.js} listen to 0.0.0.0)
    \item Created shell aliases and test scripts (\texttt{\~{}/.hydra-aliases}, \texttt{scripts/test-routes.sh})
    \item Verified /etc/hosts consistency on all 3 nodes
\end{itemize}
\end{donebox}

\begin{warningbox}
\textbf{Remaining:}
\begin{itemize}[nosep]
    \item UFW firewall setup on all 3 nodes
    \item Cerberus kernel update reboot
    \item Backup automation (etcd snapshots, DB backups)
    \item Metrics agents on Chimera/Cerberus
    \item Migrate remaining Docker services to K8s (hackathons, n8n, java-executor, git-learning, sshpiper)
\end{itemize}
\end{warningbox}

%% ============================================================
\section{Phase 0: Discovery \& Snapshot}
%% ============================================================

\subsection{Cluster Topology --- Verified}

\begin{table}[H]
\centering
\begin{tabular}{llllp{4.5cm}}
\toprule
\textbf{Node} & \textbf{IP} & \textbf{Role} & \textbf{OS} & \textbf{Resources} \\
\midrule
Hydra    & 192.168.1.160 & Control plane, etcd, master & Ubuntu 22.04.5 & 20 CPU, 256\,GB RAM, 21\,TB RAID-10 \\
Chimera  & 192.168.1.150 & Worker (GPU inference)      & Ubuntu 24.04.2 & 48 CPU, 256\,GB RAM, 3$\times$ RTX 3090 \\
Cerberus & 192.168.1.233 & Worker (GPU training)       & Ubuntu 24.04.3 & 48 CPU, 64\,GB RAM, 2$\times$ RTX 5090 \\
\bottomrule
\end{tabular}
\caption{Verified cluster topology. Cerberus confirmed at \texttt{.233} (not \texttt{.242} as in old Ansible inventory).}
\end{table}

\begin{successbox}
\textbf{RKE2 Cluster:} All 3 nodes \texttt{Ready}. RKE2 v1.28.4+rke2r1. Cluster age: 16 days. Containerd 1.7.7.
\end{successbox}

\subsection{Chimera Status}
\begin{itemize}[nosep]
    \item CPU: AMD Ryzen Threadripper 3960X (48 cores), 251\,GB RAM
    \item GPU: 3$\times$ NVIDIA RTX 3090 (24\,GB each) --- all healthy, low utilization
    \item Disk: 3.5\,TB Samsung NVMe, 54\% used
    \item Services: OpenWebUI (:3000), Ollama (:11434), metrics agent (:9100)
    \item Uptime: 5 weeks, 6 days
    \item No Docker, no Samba --- clean RKE2 agent with containerd
\end{itemize}

\subsection{Cerberus Status}
\begin{itemize}[nosep]
    \item CPU: AMD Ryzen Threadripper PRO 7965WX (48 cores), 62\,GB RAM
    \item GPU: 2$\times$ NVIDIA RTX 5090 (32\,GB each) --- healthy, idle
    \item Disk: 3.6\,TB MSI NVMe, 6\% used
    \item Services: metrics agent (:9100), SSH
    \item Uptime: 3 days, 19 hours
    \item \textbf{Kernel update pending --- system restart required}
    \item No Docker, no Samba --- clean RKE2 agent
\end{itemize}

\subsection{Docker Containers on Hydra (Pre-Audit)}

\begin{table}[H]
\centering
\small
\begin{tabular}{llll}
\toprule
\textbf{Container} & \textbf{Port(s)} & \textbf{Image} & \textbf{Status} \\
\midrule
hydra-saml-auth         & host network  & hydra-saml-auth        & Up 3d \\
traefik (Docker)        & 8081, 8082    & traefik:v3.6           & Up 3d \\
sshpiper                & 2222          & farmer1992/sshpiperd   & Up 3d \\
cs-lab-backend          & 5001          & custom build           & Up 2d \\
cs-lab-db               & 3306 (int)    & mariadb:10.11          & Up 3d \\
hackathons-app          & 45821         & hackaton-voting-app    & Up 3d \\
java-executor-service   & 55392         & docker-java-executor   & Up 6d \\
traefik-n8n-traefik-1   & 8080 (lo)     & traefik:v3.3           & Up 6d \\
traefik-n8n-n8n-1       & 5678 (lo)     & n8n                    & Up 6d \\
gg-git-learning-app-1   & 38765 (int)   & gg-git-learning-app    & Up 6d \\
n8n-user-manager (x2)   & 3000 (int)    & n8n-user-manager       & Up 6d \\
traefik-n8n-postgres-1  & 5432 (int)    & postgres:16-alpine     & Up 6d \\
\bottomrule
\end{tabular}
\caption{13 Docker containers running across 7 Compose projects.}
\end{table}

\subsection{Storage Architecture}

\begin{itemize}[nosep]
    \item \textbf{Boot disk:} \texttt{/dev/mapper/ubuntu--vg-ubuntu--lv} --- 1\,TB LVM, 27\% used
    \item \textbf{Data array:} \texttt{/dev/md0} --- 21\,TB mdadm RAID-10 (6 SSDs), mounted at \texttt{/data}, 0.3\% used
    \item \textbf{No ZFS pools} --- \texttt{zpool status} returns ``no pools available''
    \item \textbf{SSD alignment verified:} Physical block size 4096, filesystem block size 4096, scheduler \texttt{mq-deadline}
\end{itemize}

\subsection{RAID Details}
\begin{lstlisting}[style=bash]
/dev/md0: RAID-10, 6 active devices (sda-sdf)
Chunk Size: 512K, Layout: near=2
State: clean, 0 failed devices
Total: 20.96 TiB (23.04 TB)
Filesystem: ext4, 4096-byte blocks
\end{lstlisting}

%% ============================================================
\section{Phase 1: Services Disabled}
%% ============================================================

\subsection{MariaDB Host Service --- DISABLED}

\begin{donebox}
\texttt{systemctl stop mariadb \&\& systemctl disable mariadb}\\
MariaDB 10.6.23 was running as a systemd service \textit{and} as Docker container \texttt{cs-lab-db} (MariaDB 10.11). The Docker container is the active instance used by CS Lab Backend. The host service was a duplicate.
\end{donebox}

\subsection{Samba --- DISABLED \& MASKED}

\begin{donebox}
\texttt{systemctl stop smbd nmbd \&\& systemctl disable smbd nmbd \&\& systemctl mask smbd nmbd}\\
Default Ubuntu Samba config with \textbf{no custom shares defined}. Only the stock \texttt{[printers]} and \texttt{[print\$]} shares existed. Neither Chimera nor Cerberus have Samba installed. No CIFS mounts anywhere in the cluster. Ports 139/445 are now closed.
\end{donebox}

\subsection{Hydra Backend (Port 5002) --- KEPT}

\begin{infobox}
\texttt{/srv/hydra-backend/app.js} is \textbf{not legacy}. It is the admin API that:
\begin{itemize}[nosep]
    \item Creates user accounts via \texttt{/opt/hydra-scripts/create\_user.sh}
    \item Queries the \texttt{ServerDatabaseForm} table in MariaDB
    \item Retrieves PM2 and journal logs
    \item Authenticated via token in \texttt{/srv/hydra-backend/.token}
\end{itemize}
This service needs to be kept and eventually migrated to K8s.
\end{infobox}

%% ============================================================
\section{Phase 2: Storage Class Cleanup}
%% ============================================================

\begin{donebox}
\textbf{Deleted 4 orphaned ZFS storage classes:}
\begin{lstlisting}[style=bash]
kubectl delete storageclass hydra-hot hydra-warm hydra-cold hydra-gpu
\end{lstlisting}
These referenced \texttt{zfs.csi.openebs.io} but no ZFS pools exist. Storage is a single 21\,TB mdadm RAID-10 SSD array.
\end{donebox}

\textbf{Remaining storage classes:}
\begin{table}[H]
\centering
\begin{tabular}{lll}
\toprule
\textbf{Name} & \textbf{Provisioner} & \textbf{In Use} \\
\midrule
hydra-local & rancher.io/local-path & Yes (30 student PVCs) \\
hydra-nfs   & nfs.csi.k8s.io        & Yes (1 PVC) \\
local-path  & rancher.io/local-path  & No (duplicate) \\
\bottomrule
\end{tabular}
\end{table}

%% ============================================================
\section{Phase 3: CS Lab Migration to Kubernetes}
%% ============================================================

\subsection{Docker $\to$ K8s Migration}

The CS Lab website (React frontend + Express backend + MariaDB 10.11) was migrated from Docker containers to Kubernetes deployments with full data preservation.

\begin{donebox}
\textbf{Migration completed:}
\begin{enumerate}[nosep]
    \item Dumped Docker MariaDB data (132K lines, all tables)
    \item Deployed K8s MariaDB pod with PVC for persistent storage
    \item Imported initial 4-table dump into K8s MariaDB
    \item Discovered missing tables (Events, Admins, Faculty, etc.) from legacy \texttt{db.txt}
    \item Imported full schema: 15 tables with all data from \texttt{server/src/db.txt}
    \item Deployed K8s CS Lab backend connecting to K8s MariaDB
    \item Verified all API endpoints working: \texttt{/api/events}, \texttt{/api/faculty}, \texttt{/api/courses}, etc.
    \item Stopped and removed Docker containers (cs-lab-backend, cs-lab-db)
\end{enumerate}
\end{donebox}

\subsection{Database Schema --- 15 Tables}

\begin{table}[H]
\centering
\small
\begin{tabular}{lrp{6cm}}
\toprule
\textbf{Table} & \textbf{Rows} & \textbf{Purpose} \\
\midrule
Admins             & 14 & Admin users with bcrypt password hashes \\
Events             &  5 & Department events with admin FK \\
Faculty            & 13 & Faculty directory \\
FacultySemesters   &  6 & Faculty-semester assignments \\
Faqs               &  6 & FAQ entries \\
NoSchoolDays       &  2 & Holiday calendar entries \\
SchoolCalendar     &  1 & Academic calendar config \\
ServerDatabaseForm &  2 & Server access request forms \\
StudentHighlightBlog & 7 & Student project showcase \\
StudentResources   & 15 & External learning resources \\
TechBlog           & 12 & Tech blog articles \\
profiles           &  1 & Admin profile details \\
Courses            & 40 & CS course catalog \\
CourseResources    & 18 & Course materials/links \\
CompExamSettings   &  1 & Comprehensive exam config \\
\bottomrule
\end{tabular}
\caption{All 15 tables migrated from Docker MariaDB + legacy dump.}
\end{table}

\subsection{K8s Manifests}

Manifests in \texttt{k8s/components/cs-lab/}:
\begin{itemize}[nosep]
    \item \texttt{deployment.yaml} --- Backend (port 5001) + MariaDB (port 3306) deployments
    \item \texttt{service.yaml} --- ClusterIP services for backend and DB
    \item \texttt{secret.yaml} --- Database credentials
    \item \texttt{pvc.yaml} --- 5\,Gi PVC for MariaDB data
    \item \texttt{external-services.yaml} --- ExternalName services for Java executor, Git learning, hydra-backend
\end{itemize}

%% ============================================================
\section{Phase 4: Traefik Consolidation}
%% ============================================================

\subsection{Pre-Audit State: 3 Traefik Instances}

\begin{dangerbox}
Three separate Traefik instances were running:
\begin{enumerate}[nosep]
    \item \textbf{K8s Traefik} (v2.11) --- hostPort 80/443, Let's Encrypt ACME, CRD provider
    \item \textbf{Docker Traefik} (v3.6) --- port 8082, file provider for student routes
    \item \textbf{n8n Traefik} (v3.3) --- port 8080 localhost, n8n-specific routing
\end{enumerate}
\end{dangerbox}

\subsection{Apache Configuration (Inactive)}

Apache was \textbf{inactive/disabled} but had a 370-line config at \texttt{/etc/apache2/sites-enabled/hydra.newpaltz.edu.conf} containing proxy rules for all services. This config served as the historical reference for what routes need to exist.

\textbf{Routes extracted from Apache config:}
\begin{itemize}[nosep]
    \item \texttt{/dashboard, /login, /logout, /auth, /token, /check, /servers} $\to$ hydra-saml-auth (:6969)
    \item \texttt{/api/courses, /api/faculty, /api/faq, ...} $\to$ CS Lab Backend (:5001)
    \item \texttt{/students/*} $\to$ Docker Traefik (:8082) $\to$ student containers
    \item \texttt{/hackathons/} $\to$ hackathons-app (:45821)
    \item \texttt{/java/} $\to$ java-executor (:55392)
    \item \texttt{/git/} $\to$ git-learning (:8080)
    \item \texttt{/admin-api/} $\to$ hydra-backend (:5002)
    \item \texttt{gpt.hydra.newpaltz.edu} $\to$ chimera:3000 (OpenWebUI)
    \item \texttt{n8n.hydra.newpaltz.edu} $\to$ n8n (:5678)
    \item \texttt{/placeframe/} $\to$ :6721 (NOT RUNNING)
    \item \texttt{/studentmvp/} $\to$ :5175 (NOT RUNNING)
    \item \texttt{/minecraftdashboard/} $\to$ 192.168.1.145:3000 (stale external IP)
\end{itemize}

\subsection{New K8s IngressRoutes Created}

All Apache proxy rules have been converted to K8s IngressRoute CRDs:

\textbf{File: \texttt{ingressroute-production.yaml}}
\begin{itemize}[nosep]
    \item \texttt{hydra-main} --- All hydra-saml-auth routes (dashboard, login, auth, servers, API)
    \item \texttt{cs-lab-website} --- All CS Lab API and frontend routes (20+ path rules)
    \item \texttt{hackathons} --- /hackathons/ path (updated from existing)
    \item \texttt{java-executor} --- /java/ path
    \item \texttt{git-learning} --- /git/ path
    \item \texttt{hydra-default} --- Catch-all at priority 1 (CS Lab frontend)
\end{itemize}

\textbf{File: \texttt{ingressroute-subdomains.yaml}}
\begin{itemize}[nosep]
    \item \texttt{openwebui} --- \texttt{gpt.hydra.newpaltz.edu} $\to$ chimera:3000
    \item \texttt{n8n} --- \texttt{n8n.hydra.newpaltz.edu} $\to$ n8n:5678
\end{itemize}

\textbf{Stale routes removed} (services no longer running):
\begin{itemize}[nosep]
    \item \texttt{/placeframe/} --- port 6721 not listening
    \item \texttt{/studentmvp/} --- port 5175 not listening
    \item \texttt{/minecraftdashboard/} --- 192.168.1.145 is not a cluster node
\end{itemize}

%% ============================================================
\section{Phase 5: Cleanup Actions}
%% ============================================================

\subsection{Static Content Archived \& Removed}

\begin{donebox}
\texttt{/var/www/} ($\sim$436\,MB) archived to \texttt{var-www-backup.tar.gz} then removed:
\begin{itemize}[nosep]
    \item \texttt{/var/www/FLAPJS-WebApp/} --- JFLAP automata simulator
    \item \texttt{/var/www/interview-coach/} --- Interview practice app
    \item \texttt{/var/www/lccjs/} --- LC-3 JavaScript simulator
    \item \texttt{/var/www/LccWebUI/} --- LC-3 Web UI
    \item \texttt{/var/www/gpt/} --- Old GPT static files
    \item \texttt{/var/www/SUNYCAT.png} --- 772\,KB image
    \item \texttt{/var/www/html/} contents (kept \texttt{.well-known/} for ACME)
\end{itemize}
Apache was already inactive. None of this content was being served.
\end{donebox}

\subsection{Apache Config Archived}

\begin{donebox}
Full Apache config archived to \texttt{apache-full-backup.tar.gz}. Stale files removed:
\begin{itemize}[nosep]
    \item \texttt{hydra.newpaltz.edu.conf.bak} --- removed
    \item \texttt{lccjs.conf} symlink --- removed
\end{itemize}
Main config retained as reference in \texttt{sites-available/}.
\end{donebox}

\subsection{Docker Cleanup}

\begin{donebox}
\textbf{Containers stopped and removed} (now running in K8s):
\begin{itemize}[nosep]
    \item \texttt{cs-lab-backend} --- replaced by K8s deployment
    \item \texttt{cs-lab-db} --- replaced by K8s MariaDB pod
    \item \texttt{hydra-saml-auth} --- replaced by K8s \texttt{hydra-auth} deployment
    \item \texttt{traefik} (standalone, ports 8081/8082) --- replaced by K8s Traefik pod
\end{itemize}

\textbf{Docker images removed:}
\begin{itemize}[nosep]
    \item \texttt{newpaltz-cs-lab-website-backend}, \texttt{mariadb:10.11}, \texttt{traefik:v2.11}
    \item \texttt{hydra-saml-auth} (multiple tags), \texttt{portainer/portainer-ce}
    \item \texttt{nginx:stable-perl}, \texttt{busybox}, duplicate \texttt{traefik-n8n-user-manager}
    \item 100+ dangling image layers pruned
\end{itemize}

\textbf{35 unused Docker volumes removed.}
\end{donebox}

\textbf{Remaining Docker containers (8, still needed):}
\begin{table}[H]
\centering
\small
\begin{tabular}{llp{5cm}}
\toprule
\textbf{Container} & \textbf{Port} & \textbf{Why Still Docker} \\
\midrule
hackathons-app          & 45821     & ExternalName svc, not yet K8s native \\
traefik-n8n-traefik-1   & 8080      & Routes git-learning via ExternalName \\
traefik-n8n-n8n-1       & 5678      & n8n workflow engine \\
traefik-n8n-n8n-user-manager & 3000 & n8n user management API \\
traefik-n8n-postgres-1  & 5432      & PostgreSQL for n8n \\
sshpiper                & 2222      & Student SSH proxy \\
gg-git-learning-app-1   & 38765     & Git learning app \\
java-executor-service   & 55392     & Java code executor \\
\bottomrule
\end{tabular}
\end{table}

%% ============================================================
\section{Phase 6: Backups Created}
%% ============================================================

All backups stored in \texttt{/home/infra/hydra-audit-20260204/backups/}:

\begin{table}[H]
\centering
\small
\begin{tabular}{lp{8cm}}
\toprule
\textbf{File} & \textbf{Contents} \\
\midrule
\texttt{cslab-docker-compose.yml} & CS Lab Docker Compose \\
\texttt{hydra-saml-auth-docker-compose.yaml} & Main auth app + Docker Traefik \\
\texttt{sshpiper-docker-compose.yaml} & SSHPiper config \\
\texttt{hackathons-docker-compose.yml} & Hackathon voting app \\
\texttt{java-executor-docker-compose.yml} & Java code executor \\
\texttt{traefik-n8n-docker-compose.yaml} & n8n + Traefik + Postgres \\
\texttt{gg-git-learning-docker-compose.yml} & Git learning app \\
\texttt{apache-hydra.conf} & Apache main vhost config \\
\texttt{apache-lccjs.conf} & Apache lccjs vhost \\
\texttt{traefik-dynamic/} & All Traefik file-provider configs \\
\texttt{cslab.env} & CS Lab environment variables \\
\texttt{hydra-saml-auth.env} & Auth app environment \\
\texttt{hydra-backend.env} & Admin API environment \\
\texttt{cslab-mariadb-full-dump.sql} & Full MariaDB dump (5\,MB) \\
\texttt{var-www-backup.tar.gz} & Archived /var/www content \\
\texttt{apache-full-backup.tar.gz} & Archived Apache config \\
\bottomrule
\end{tabular}
\caption{Complete backup manifest.}
\end{table}

%% ============================================================
\section{Phase 7: Network \& Security Findings}
%% ============================================================

\subsection{Externally Exposed Ports (Pre-Hardening)}

\begin{table}[H]
\centering
\begin{tabular}{llll}
\toprule
\textbf{Port} & \textbf{Service} & \textbf{Status} & \textbf{Action} \\
\midrule
22    & SSH            & Required    & Keep \\
80    & HTTP (Traefik) & Required    & Keep \\
443   & HTTPS (Traefik) & Required  & Keep \\
111   & rpcbind (NFS)  & Exposed     & Restrict to cluster \\
139   & Samba          & \textbf{Closed}  & Samba disabled \\
445   & Samba          & \textbf{Closed}  & Samba disabled \\
2049  & NFS            & Exposed     & Restrict to cluster \\
2222  & SSHPiper       & Required    & Keep \\
5001  & CS Lab         & Exposed     & Move behind Traefik \\
6443  & K8s API        & Exposed     & Restrict to cluster \\
6969  & hydra-auth     & Exposed     & Move behind Traefik \\
8081  & Traefik Dash   & Exposed     & Restrict to localhost \\
8082  & Docker Traefik & Exposed     & Consolidate to K8s \\
9345  & RKE2 Reg       & Exposed     & Restrict to cluster \\
45821 & Hackathons     & Exposed     & Move behind Traefik \\
55392 & Java Executor  & Exposed     & Move behind Traefik \\
\bottomrule
\end{tabular}
\caption{UFW firewall not yet enabled --- pending final validation.}
\end{table}

\subsection{/etc/hosts Verification}

All three nodes have consistent \texttt{/etc/hosts} entries:
\begin{lstlisting}[style=bash]
192.168.1.160 hydra
192.168.1.150 chimera
192.168.1.233 cerberus
\end{lstlisting}

%% ============================================================
\section{Phase 8: GPU Operator Fix}
%% ============================================================

\begin{donebox}
\textbf{Problem:} GPU operator DaemonSet pods stuck in \texttt{Init:0/1} on Hydra (no GPU). The error was: \texttt{no runtime for ``nvidia'' is configured}.

\textbf{Fix:} Set all \texttt{nvidia.com/gpu.deploy.*} labels to \texttt{false} on Hydra node:
\begin{lstlisting}[style=bash]
kubectl label node hydra \
  nvidia.com/gpu.deploy.container-toolkit=false \
  nvidia.com/gpu.deploy.device-plugin=false \
  nvidia.com/gpu.deploy.gpu-feature-discovery=false \
  nvidia.com/gpu.deploy.operator-validator=false \
  nvidia.com/gpu.present=false --overwrite
\end{lstlisting}

\textbf{Result:} Only the NFD worker (expected on all nodes) remains on Hydra. All GPU pods properly running on Chimera and Cerberus only.
\end{donebox}

%% ============================================================
\section{Phase 9: Route Testing \& IngressRoutes}
%% ============================================================

\begin{donebox}
All 8 IngressRoutes applied and verified:
\begin{table}[H]
\centering
\small
\begin{tabular}{llll}
\toprule
\textbf{IngressRoute} & \textbf{Match} & \textbf{Backend} & \textbf{Status} \\
\midrule
hydra-main     & /dashboard, /login, /auth, etc. & hydra-auth:6969     & 200/302 \\
cs-lab-website & /api/*, /courses, /events, etc. & cs-lab-backend:5001 & 200 \\
hackathons     & /hackathons/                    & hackathons:45821    & 200 \\
java-executor  & /java/                          & java-executor:55392 & Routed \\
git-learning   & /git/                           & git-learning:8080   & Routed \\
hydra-default  & catch-all (priority 1)          & cs-lab-backend:5001 & 200 \\
openwebui      & gpt.hydra.newpaltz.edu          & chimera:3000        & 200 \\
n8n            & n8n.hydra.newpaltz.edu          & n8n:5678            & 200 \\
\bottomrule
\end{tabular}
\end{table}

\textbf{Fixes applied during testing:}
\begin{itemize}[nosep]
    \item n8n Docker port changed from \texttt{127.0.0.1:5678} to \texttt{0.0.0.0:5678}
    \item n8n-traefik Docker port changed from \texttt{127.0.0.1:8080} to \texttt{0.0.0.0:8080}
    \item \texttt{/srv/hydra-backend/app.js} listen changed from \texttt{127.0.0.1} to \texttt{0.0.0.0}
    \item IngressRoute API group fixed: \texttt{traefik.io/v1alpha1} $\to$ \texttt{traefik.containo.us/v1alpha1}
\end{itemize}
\end{donebox}

%% ============================================================
\section{Remaining Work}
%% ============================================================

\begin{enumerate}
    \item \textbf{UFW firewall} --- Enable firewall on all 3 nodes (do last, keep SSH fallback)
    \item \textbf{Cerberus reboot} --- Pending kernel update requires system restart
    \item \textbf{Backup automation} --- Daily etcd snapshots, K8s MariaDB dumps, config exports
    \item \textbf{Metrics agents} --- Deploy Prometheus node exporter on Chimera and Cerberus
    \item \textbf{Migrate remaining Docker $\to$ K8s} --- hackathons, n8n stack, java-executor, git-learning, sshpiper
    \item \textbf{n8n auth typo} --- Fix \texttt{mplotkin@jewpaltz.com} $\to$ \texttt{mplotkin@newpaltz.edu} in PostgreSQL
\end{enumerate}

\end{document}
